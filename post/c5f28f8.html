<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"notes.camcad.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="为什么学习mfc如果你是在Windows平台上做GUI开发，mfc(微软基础类库)是一个很好的选择，毕竟Windows累积用户群庞大，市场接受程度高。 但是，学习mfc不仅仅要学习用mfc，还要学习mfc的框架设计思想。 很多公司在一些做了很久的项目上，往往都是有自己的类库、自己的框架，我们只需要在其基础上不断的完善和扩展。如果你不了解类库，你是根本无从下手。这也是我们要学习类库、框架设计的原因">
<meta property="og:type" content="article">
<meta property="og:title" content="MFC新手村01：Windows消息机制">
<meta property="og:url" content="https://notes.camcad.cn/post/c5f28f8.html">
<meta property="og:site_name" content="知识储存库">
<meta property="og:description" content="为什么学习mfc如果你是在Windows平台上做GUI开发，mfc(微软基础类库)是一个很好的选择，毕竟Windows累积用户群庞大，市场接受程度高。 但是，学习mfc不仅仅要学习用mfc，还要学习mfc的框架设计思想。 很多公司在一些做了很久的项目上，往往都是有自己的类库、自己的框架，我们只需要在其基础上不断的完善和扩展。如果你不了解类库，你是根本无从下手。这也是我们要学习类库、框架设计的原因">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://image.camcad.cn/2022/02/202202141209188-1024x696.png">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071912530922.png">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071912550813-1024x473.png">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913034885.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913042484.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913045062.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913051998.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913054683.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/202107191318134-1024x333.jpg">
<meta property="og:image" content="http://image.camcad.cn/2021/07/2021071913590914.jpg">
<meta property="article:published_time" content="2022-02-14T20:09:55.000Z">
<meta property="article:modified_time" content="2024-05-13T01:49:23.277Z">
<meta property="article:author" content="蚂蚁Emmet">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="MFC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://image.camcad.cn/2022/02/202202141209188-1024x696.png">


<link rel="canonical" href="https://notes.camcad.cn/post/c5f28f8.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://notes.camcad.cn/post/c5f28f8.html","path":"post/c5f28f8.html","title":"MFC新手村01：Windows消息机制"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MFC新手村01：Windows消息机制 | 知识储存库</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="知识储存库" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">知识储存库</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">增长盈利，降本增效<br>逆境求生存，顺境求发展</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友链"><a href="/links/" rel="section"><i class="fa fa-globe fa-fw"></i>友链</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AD%A6%E4%B9%A0mfc"><span class="nav-number">1.</span> <span class="nav-text">为什么学习mfc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6"><span class="nav-number">2.</span> <span class="nav-text">Windows消息机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A"><span class="nav-number">2.1.</span> <span class="nav-text">基本概念解释</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89SDK%E5%92%8CAPI"><span class="nav-number">2.1.1.</span> <span class="nav-text">1）SDK和API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89-%E7%AA%97%E5%8F%A3%E5%92%8C%E5%8F%A5%E6%9F%84"><span class="nav-number">2.1.2.</span> <span class="nav-text">2） 窗口和句柄</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E6%B6%88%E6%81%AF%E4%B8%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="nav-number">2.1.3.</span> <span class="nav-text">3）消息与消息队列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89WinMain%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.4.</span> <span class="nav-text">4）WinMain函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="nav-number">2.2.</span> <span class="nav-text">Windows 编程模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-number">2.2.1.</span> <span class="nav-text">1）项目的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89WinMain%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">2.2.2.</span> <span class="nav-text">2）WinMain函数的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3"><span class="nav-number">2.2.3.</span> <span class="nav-text">3）创建一个窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a%EF%BC%89%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3%E7%B1%BB"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">a）设计一个窗口类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b%EF%BC%89%E6%B3%A8%E5%86%8C%E7%AA%97%E5%8F%A3%E7%B1%BB"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">b）注册窗口类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c%EF%BC%89-%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">c） 创建窗口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#d%EF%BC%89%E6%98%BE%E7%A4%BA%E5%8F%8A%E6%9B%B4%E6%96%B0%E7%AA%97%E5%8F%A3"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">d）显示及更新窗口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#e%EF%BC%89%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.3.5.</span> <span class="nav-text">e）示例代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89%E6%B6%88%E6%81%AF%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.2.4.</span> <span class="nav-text">4）消息循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%89%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0-%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="nav-number">2.2.5.</span> <span class="nav-text">5）窗口过程函数(消息处理函数)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%89%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.6.</span> <span class="nav-text">6）完整示例代码</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="蚂蚁Emmet"
      src="http://image.camcad.cn/2020/06/2020061804552287.png">
  <p class="site-author-name" itemprop="name">蚂蚁Emmet</p>
  <div class="site-description" itemprop="description">制造业IT宅男,喜欢折腾C++和被它折腾 ^_^ ^_^</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">405</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:emmet@camcad.cn" title="E-Mail → mailto:emmet@camcad.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/ugopen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ugopen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://notes.camcad.cn/post/c5f28f8.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://image.camcad.cn/2020/06/2020061804552287.png">
      <meta itemprop="name" content="蚂蚁Emmet">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知识储存库">
      <meta itemprop="description" content="制造业IT宅男,喜欢折腾C++和被它折腾 ^_^ ^_^">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MFC新手村01：Windows消息机制 | 知识储存库">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MFC新手村01：Windows消息机制
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-14 20:09:55" itemprop="dateCreated datePublished" datetime="2022-02-14T20:09:55+00:00">2022-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MFC%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">MFC基础教程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="http://image.camcad.cn/2022/02/202202141209188.png"><img src="http://image.camcad.cn/2022/02/202202141209188-1024x696.png"></a></p>
<h2 id="为什么学习mfc"><a href="#为什么学习mfc" class="headerlink" title="为什么学习mfc"></a>为什么学习mfc</h2><p>如果你是在Windows平台上做GUI开发，mfc(微软基础类库)是一个很好的选择，毕竟Windows累积用户群庞大，市场接受程度高。</p>
<p>但是，学习mfc不仅仅要学习用mfc，还要学习mfc的框架设计思想。</p>
<p>很多公司在一些做了很久的项目上，往往都是有自己的类库、自己的框架，我们只需要在其基础上不断的完善和扩展。如果你不了解类库，你是根本无从下手。这也是我们要学习类库、框架设计的原因。</p>
<p>如果仅仅会用mfc的话，可能在找工作的时候，一旦工作内容离开了mfc，就什么也不会了。学习任何东西都是一样的，学的是方法，而不仅仅是某个技术本身，因为技术肯定不停地更新的，你今天学的现在能用上，但是谁也不能保住以后会怎么样，但是万变不离其中，懂得了方法，学什么都一样。</p>
<span id="more"></span>

<h2 id="Windows消息机制"><a href="#Windows消息机制" class="headerlink" title="Windows消息机制"></a>Windows消息机制</h2><p>要想熟练掌握 Windows 应用程序的开发， 首先需要理解 Windows 平台下程序运行的内部机制。如果想要更好的学习掌握 mfc，必须要先了解Windows 程序的内部运行机制，为我们扫清学习路途中的第一个障碍，为进一步学习 mfc程序打下基础。</p>
<h3 id="基本概念解释"><a href="#基本概念解释" class="headerlink" title="基本概念解释"></a>基本概念解释</h3><p>我们在编写标准C程序的时候,经常会调用各种库函数来辅助完成某些功能：初学者使用得最多的C库函数就是printf了，这些库函数是由你所使用的编译器厂商提供的。在Windows平台下，也有类似的函数可供调用：不同的是，这些函数是由Windows操作系统本身提供的。</p>
<h4 id="1）SDK和API"><a href="#1）SDK和API" class="headerlink" title="1）SDK和API"></a>1）SDK和API</h4><p><strong>SDK：</strong> 软件开发工具包（Software Development Kit），一般都是一些被软件工程师用于为特定的软件包、软件框架、硬件平台、操作系统等建立应用软件的开发工具的集合。</p>
<p><strong>API函数：</strong> Windows操作系统提供给应用程序编程的接口（Application Programming Interface）。</p>
<p>Windows应用程序API函数是通过C语言实现的，所有主要的 Windows 函数都在 Windows.h 头文件中进行了声明。Windows 操作系统提供了 1000 多种 API函数。</p>
<h4 id="2）-窗口和句柄"><a href="#2）-窗口和句柄" class="headerlink" title="2） 窗口和句柄"></a>2） 窗口和句柄</h4><p>窗口是 Windows 应用程序中一个非常重要的元素，一个 Windows 应用程序至少要有一个窗口，称为主窗口。</p>
<p>窗口是屏幕上的一块矩形区域，是 Windows 应用程序与用户进行交互的接口。利用窗口可以接收用户的输入、以及显示输出。</p>
<p>一个应用程序窗口通常都包含标题栏、菜单栏、系统菜单、最小化框、最大化框、 可调边框，有的还有滚动条。如下图：<br><a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071912530922.png"><img src="http://image.camcad.cn/2021/07/2021071912530922.png"></a></p>
<p>窗口可以分为客户区和非客户区， 如上图。 客户区是窗口的一部分， 应用程序通常在客户区中显示文字或者绘制图形。</p>
<p>标题栏、 菜单栏、 系统菜单、 最小化框和最大化框、 可调边框统称为窗口的非客户区， 它们由 Windows 系统来管理， 而应用程序则主要管理客户区的外观及操作。</p>
<p>窗口可以有一个父窗口， 有父窗口的窗口称为子窗口。除了上图所示类型的窗口外， 对话框和消息框也是一种窗口。 在对话框上通常还包含许多子窗口， 这些子窗口的形式有按钮、 单选按钮、 复选框、 组框、 文本编辑框等。</p>
<p>在 Windows 应用程序中， 窗口是通过窗口句柄（ HWND） 来标识的。 我们要对某个窗口进行操作， 首先就要得到这个窗口的句柄。</p>
<p>句柄（ HANDLE） 是 Windows 程序中一个重要的概念， 使用也非常频繁。 在 Windows 程序中， 有各种各样的资源（ 窗口、 图标、光标,画刷等）， 系统在创建这些资源时会为它们分配内存， 并返回标识这些资源的标识号， 即句柄。 在后面的内容中我们还会看到图标句柄（ HICON）、 光标句柄（ HCURSOR） 和画刷句柄（ HBRUSH）。</p>
<h4 id="3）消息与消息队列"><a href="#3）消息与消息队列" class="headerlink" title="3）消息与消息队列"></a>3）消息与消息队列</h4><p>Windows 程序设计是一种完全不同于传统的 DOS 方式的程序设计方法。它是一种事件驱动方式的程序设计模式，主要是基于消息的。</p>
<p>每一个 Windows 应用程序开始执行后， 系统都会为该程序创建一个消息队列， 这个消息队列用来存放该程序创建的窗口的消息。</p>
<p>例如，当用户在窗口中画图的时候，按下鼠标左键，此时，操作系统会感知到这一事件，于是将这个事件包装成一个消息，投递到应用程序的消息队列中，等待应用程序的处理。</p>
<p>然后应用程序通过一个消息循环不断地从消息队列中取出消息，并进行响应。</p>
<p>在这个处理过程中，操作系统也会给应用程序“ 发送消息”。所谓“ 发送消息”，实际上是操作系统调用程序中一个专门负责处理消息的函数，这个函数称为窗口过程。<br><a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071912550813.png"><img src="http://image.camcad.cn/2021/07/2021071912550813-1024x473.png"></a></p>
<h4 id="4）WinMain函数"><a href="#4）WinMain函数" class="headerlink" title="4）WinMain函数"></a>4）WinMain函数</h4><p>当Windows操作系统启动一个程序时，它调用的就是该程序的WinMain函数（ 实际是由插入到可执行文件中的启动代码调用的）。 WinMain是Windows程序的入口点函数，与DOS程序的入口点函数main的作用相同，当WinMain 函数结束或返回时，Windows应用程序结束。</p>
<h3 id="Windows-编程模型"><a href="#Windows-编程模型" class="headerlink" title="Windows 编程模型"></a>Windows 编程模型</h3><p>一个完整的Win32程序(windows.h)，该程序实现的功能是创建一个窗口，并在该窗口中响应键盘及鼠标消息，程序的实现步骤为：</p>
<ul>
<li>1）WinMain函数的定义</li>
<li>2）创建一个窗口</li>
<li>3）进行消息循环</li>
<li>4）编写窗口过程函数</li>
</ul>
<h4 id="1）项目的创建"><a href="#1）项目的创建" class="headerlink" title="1）项目的创建"></a>1）项目的创建</h4><p><a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913034885.jpg"><img src="http://image.camcad.cn/2021/07/2021071913034885.jpg"></a> <a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913042484.jpg"><img src="http://image.camcad.cn/2021/07/2021071913042484.jpg"></a> <a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913045062.jpg"><img src="http://image.camcad.cn/2021/07/2021071913045062.jpg"></a> <a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913051998.jpg"><img src="http://image.camcad.cn/2021/07/2021071913051998.jpg"></a> <a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913054683.jpg"><img src="http://image.camcad.cn/2021/07/2021071913054683.jpg"></a></p>
<h4 id="2）WinMain函数的定义"><a href="#2）WinMain函数的定义" class="headerlink" title="2）WinMain函数的定义"></a>2）WinMain函数的定义</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WINAPI 代表 __stdcall 参数的传递顺序,从右到左 以此入栈，并且在函数返回前清空堆栈</span></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,     <span class="comment">// 应用程序实例句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,                <span class="comment">// 上一个应用程序句柄，在win32环境下，参数一般为NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPSTR lpCmdLine,                        <span class="comment">// char * argc[]</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> nShowCmd)</span>                           <span class="comment">// 显示命令、最大化、最小化、正常</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>WINAPI</code>：是一个宏，它代表的是__stdcall（注意是两个下划线），表示的是参数传递的顺序：从右往左入栈，同时在函数返回前自动清空堆栈。</li>
<li><code>hInstance</code>：表示该程序当前运行的实例的句柄，这是一个数值。当程序在Windows下运行时，它唯一标识运行中的实例（注意，只有运行中的程序实例， 才有实例句柄）。一个应用程序可以运行多个实例，每运行一个实例，系统都会给该实例分配一个句柄值，并通过hInstance参数传递给 WinMain 函数。</li>
<li><code>hPrevInstance</code>：表示当前实例的前一个实例的句柄。在Win32环境下，这个参数总是NULL，即在Win32环境下，这个参数不再起作用。</li>
<li><code>lpCmdLine</code>：是一个以空终止的字符串， 指定传递给应用程序的命令行参数，相当于C或C++中的main函数中的参数char *argv[]。</li>
<li><code>nShowCmd</code>：表示一个窗口的显示，表示它是要最大化显示、最小化显示、正常大小显示还是隐藏显示。</li>
</ul>
<h4 id="3）创建一个窗口"><a href="#3）创建一个窗口" class="headerlink" title="3）创建一个窗口"></a>3）创建一个窗口</h4><p>创建一个完整的窗口，需要经过下面几个步骤：</p>
<ul>
<li>a. 设计一个窗口类</li>
<li>b. 注册窗口类</li>
<li>c. 创建窗口</li>
<li>d. 显示及更新窗口</li>
</ul>
<h5 id="a）设计一个窗口类"><a href="#a）设计一个窗口类" class="headerlink" title="a）设计一个窗口类"></a>a）设计一个窗口类</h5><p>一个完整的窗口具有许多特征， 包括光标（鼠标进入该窗口时的形状）、图标、背景色等。窗口的创建过程类似于汽车的制造过程。</p>
<p>我们在生产一个型号的汽车之前， 首先要对该型号的汽车进行设计， 在图纸上画出汽车的结构图， 设计各个零部件， 同时还要给该型号的汽车取一个响亮的名字， 例如“宝马 x6”。 类似地， 在创建一个窗口前， 也必须对该类型的窗口进行设计， 指定窗口的特征。在Windows中，窗口的特征就是由WNDCLASS结构体来定义的，我们只需给WNDCLASS结构体对应的成员赋值，即可完成窗口类的设计。</p>
<p>WNDCLASS结构体的定义如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_WNDCLASS</span>&#123;</span><br><span class="line">    UINT        style;</span><br><span class="line">    WNDPROC     lpfnWndProc;</span><br><span class="line">    <span class="type">int</span>         cbClsExtra;</span><br><span class="line">    <span class="type">int</span>         cbWndExtra;</span><br><span class="line">    HINSTANCE   hInstance;</span><br><span class="line">    HICON       hIcon;</span><br><span class="line">    HCURSOR     hCursor;</span><br><span class="line">    HBRUSH      hbrBackground;</span><br><span class="line">    LPCWSTR     lpszMenuName;</span><br><span class="line">    LPCWSTR     lpszClassName;</span><br><span class="line">&#125; WNDCLASS;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>style</code>：指定窗口的样式(风格)，常用的样式如下：</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/202107191318134.jpg"><img src="http://image.camcad.cn/2021/07/202107191318134-1024x333.jpg"></a></p>
<ul>
<li><code>lpfnWndProc</code>：指定一个窗口回调函数，是一个函数的指针。</li>
</ul>
<p>当应用程序收到给某一窗口的消息时，就应该调用某一函数来处理这条消息。这一调用过程不用应用程序自己来实施，而由操作系统来完成，但是，回调函数本身的代码必须由应用程序自己完成。对于一条消息，操作系统调用的是接受消息的窗口所属的类型中的lpfnWndProc成员指定的函数。每一种不同类型的窗口都有自己专用的回调函数，该函数就是通过lpfnWndProc成员指定的。</p>
<ul>
<li>回调函数的定义形式如下：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,      <span class="comment">//信息所属的窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uMsg,      <span class="comment">//消息类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加信息(如键盘哪个键按下)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam   <span class="comment">//附加信息(如鼠标点击坐标)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cbClsExtra</code>：类的附加内存，通常数情况下为0。</li>
<li><code>cbWndExtra</code>：窗口附加内存，通常情况下为0。</li>
<li><code>hInstance</code>：当前实例句柄，用WinMain中的形参hInstance为其赋值。</li>
<li><code>hIcon</code>：指定窗口类的图标句柄，设置为NULL，则使用默认图标，也可用如下函数进行赋值：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HICON <span class="title">LoadIcon</span><span class="params">(HINSTANCE hInstance, LPCTSTR lpIconName)</span></span>;</span><br><span class="line">如：<span class="built_in">LoadIcon</span>(<span class="literal">NULL</span>, IDI_WARNING); <span class="comment">//第一个参数为NULL，加载系统默认图标</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>hCursor</code>：指定窗口类的光标句柄，设置为NULL，则使用默认图标，也可用如下函数进行赋值：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HCURSOR <span class="title">LoadCursor</span><span class="params">(HINSTANCE hInstance, LPCTSTR lpCursorName)</span></span>;</span><br><span class="line">如：<span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_HELP); <span class="comment">//第一个参数为NULL，加载系统默认光标</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>hbrBackground</code>：指示窗口的背景颜色，可用如下函数进行赋值：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HGDIOBJ <span class="title">GetStockObject</span><span class="params">(<span class="type">int</span> fnObject)</span></span>;</span><br><span class="line">如：<span class="built_in">GetStockObject</span>(WHITE_BRUSH);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>lpszMenuName</code>：指定菜单资源的名字。如果设置为NULL，那么基于这个窗口类创建的窗口将没有默认菜单。</li>
<li><code>lpszClassName</code>：指定窗口类的名字。</li>
</ul>
<p>示例代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">WNDCLASS wc;    <span class="comment">//窗口类变量</span></span><br><span class="line">    wc.cbClsExtra = <span class="number">0</span>;  <span class="comment">//类附加内存</span></span><br><span class="line">    wc.cbWndExtra = <span class="number">0</span>;  <span class="comment">//窗口附加内存</span></span><br><span class="line">    wc.hbrBackground = (HBRUSH)<span class="built_in">GetStockObject</span>(WHITE_BRUSH); <span class="comment">//背景色为白色</span></span><br><span class="line">    wc.hCursor = (HCURSOR)<span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_HELP);   <span class="comment">//帮助光标</span></span><br><span class="line">    wc.hIcon = (HICON)<span class="built_in">LoadIcon</span>(<span class="literal">NULL</span>, IDI_WARNING);  <span class="comment">//警告图标</span></span><br><span class="line">    wc.hInstance = hInstance;   <span class="comment">//应用程序实例，为WinMain第1个形参</span></span><br><span class="line">    wc.lpfnWndProc = WinProc;   <span class="comment">//窗口过程函数名字</span></span><br><span class="line">    wc.lpszClassName = <span class="built_in">TEXT</span>(<span class="string">&quot;MyWin&quot;</span>); <span class="comment">//类的名字</span></span><br><span class="line">    wc.lpszMenuName = <span class="literal">NULL</span>; <span class="comment">//没有菜单</span></span><br><span class="line">    wc.style = <span class="number">0</span>;   <span class="comment">//类的风格，填0，使用默认风格</span></span><br></pre></td></tr></table></figure>

<h5 id="b）注册窗口类"><a href="#b）注册窗口类" class="headerlink" title="b）注册窗口类"></a>b）注册窗口类</h5><p>设计完窗口类（WNDCLASS）后， 需要调用RegisterClass函数对其进行注册，注册成功后，才可以创建该类型的窗口。 注册函数的原型声明如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function">ATOM <span class="title">RegisterClass</span><span class="params">(CONST WNDCLASS *lpWndClass)</span></span>;</span><br><span class="line"></span><br><span class="line">使用示例：<span class="built_in">RegisterClass</span>(&amp;wc);</span><br></pre></td></tr></table></figure>

<h5 id="c）-创建窗口"><a href="#c）-创建窗口" class="headerlink" title="c） 创建窗口"></a>c） 创建窗口</h5><p>设计好窗口类并且将其成功注册之后， 即可用CreateWindow函数产生这种类型的窗口了。</p>
<p>CreateWindow函数的原型声明如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HWND <span class="title">CreateWindow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        LPCTSTR lpClassName,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPCTSTR lpWindowName,</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dwStyle,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int</span> x,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int</span> y,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int</span> nWidth,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int</span> nHeight,</span></span></span><br><span class="line"><span class="params"><span class="function">        HWND hWndParent,</span></span></span><br><span class="line"><span class="params"><span class="function">        HMENU hMenu,</span></span></span><br><span class="line"><span class="params"><span class="function">        HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID lpParam)</span></span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>lpClassName</code>：指定窗口类的名称，此名字必须和WNDCLASS的lpszClassName成员指定的名称一样。</li>
<li><code>lpWindowName</code>：指定窗口的名字，即窗口的标题。</li>
<li><code>dwStyle</code>：指定创建的窗口的样式，常指定为指WS_OVERLAPPEDWINDOW类型，这是一种多种窗口类型的组合类型。</li>
<li><code>x, y</code>：指定窗口左上角的x，y坐标。如果参数x被设为CW_USEDEFAULT，那么系统为窗口选择默认的左上角坐标并忽略y参数。</li>
<li><code>nWidth，nHeight</code>：指定窗口窗口的宽度，高度。如果参数nWidth被设为 CW_USEDEFAULT，那么系统为窗口选择默认的宽度和高度，参数nHeight被忽略。</li>
<li><code>hWndParent</code>：指定被创建窗口的父窗口句柄，没有父窗口，则设置NULL。</li>
<li><code>hMenu</code>：指定窗口菜单的句柄，没有，则设置为NULL。</li>
<li><code>hInstance</code>：窗口所属的应用程序实例的句柄，用WinMain中的形参hInstance为其赋值。</li>
<li><code>lpParam</code>：作为WM_CREATE消息的附加参数lParam传入的数据指针。通常设置为NULL。</li>
</ul>
<p>返回值说明：如果窗口创建成功，CreateWindow函数将返回系统为该窗口分配的句柄，否则，返回NULL。</p>
<p>示例代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HWND  hWnd = <span class="built_in">CreateWindow</span>(</span><br><span class="line"><span class="built_in">TEXT</span>(<span class="string">&quot;MyWin&quot;</span>),  <span class="comment">//窗口类名字</span></span><br><span class="line"><span class="built_in">TEXT</span>(<span class="string">&quot;测试&quot;</span>),      <span class="comment">//窗口标题</span></span><br><span class="line">WS_OVERLAPPEDWINDOW,  <span class="comment">//窗口风格    </span></span><br><span class="line">CW_USEDEFAULT, CW_USEDEFAULT,  <span class="comment">//窗口x，y坐标，使用默认值</span></span><br><span class="line">CW_USEDEFAULT, CW_USEDEFAULT,  <span class="comment">//窗口宽度，高度，使用默认值</span></span><br><span class="line"><span class="literal">NULL</span>,   <span class="comment">//无父窗口</span></span><br><span class="line"><span class="literal">NULL</span>,   <span class="comment">//无菜单</span></span><br><span class="line">hInstance,  <span class="comment">//应用程序实例句柄，为WinMain第1个形参</span></span><br><span class="line"><span class="literal">NULL</span>);  <span class="comment">//附件信息，通常设置为NULL</span></span><br></pre></td></tr></table></figure>

<h5 id="d）显示及更新窗口"><a href="#d）显示及更新窗口" class="headerlink" title="d）显示及更新窗口"></a>d）显示及更新窗口</h5><p>显示窗口函数原型：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ShowWindow</span><span class="params">(HWND hWnd, <span class="type">int</span> nCmdShow)</span></span>;</span><br></pre></td></tr></table></figure>

<p>更新窗口函数原型：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">UpdateWindow</span><span class="params">(HWND hWnd)</span></span>;</span><br></pre></td></tr></table></figure>

<p>示例代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ShowWindow</span>(hWnd, SW_SHOWNORMAL); <span class="comment">//SW_SHOWNORMAL为普通模式</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UpdateWindow</span>(hWnd);</span><br></pre></td></tr></table></figure>

<h5 id="e）示例代码"><a href="#e）示例代码" class="headerlink" title="e）示例代码"></a>e）示例代码</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设计一个窗口类</span></span><br><span class="line">WNDCLASS wc;    <span class="comment">//窗口类变量</span></span><br><span class="line">wc.cbClsExtra = <span class="number">0</span>;  <span class="comment">//类附加内存</span></span><br><span class="line">wc.cbWndExtra = <span class="number">0</span>;  <span class="comment">//窗口附加内存</span></span><br><span class="line">wc.hbrBackground = (HBRUSH)<span class="built_in">GetStockObject</span>(WHITE_BRUSH); <span class="comment">//背景色为白色</span></span><br><span class="line">wc.hCursor = <span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_HELP);    <span class="comment">//帮助光标</span></span><br><span class="line">wc.hIcon = <span class="built_in">LoadIcon</span>(<span class="literal">NULL</span>, IDI_WARNING); <span class="comment">//警告图标</span></span><br><span class="line">wc.hInstance = hInstance;   <span class="comment">//应用程序实例，为WinMain第1个形参</span></span><br><span class="line">wc.lpfnWndProc = WinProc;   <span class="comment">//窗口过程函数名字</span></span><br><span class="line">wc.lpszClassName = <span class="built_in">TEXT</span>(<span class="string">&quot;MyWin&quot;</span>); <span class="comment">//类的名字</span></span><br><span class="line">wc.lpszMenuName = <span class="literal">NULL</span>; <span class="comment">//没有菜单</span></span><br><span class="line">wc.style = <span class="number">0</span>;   <span class="comment">//类的风格，填0，使用默认风格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注册窗口类</span></span><br><span class="line"><span class="built_in">RegisterClass</span>(&amp;wc);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建窗口</span></span><br><span class="line">HWND  hWnd = <span class="built_in">CreateWindow</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;MyWin&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;测试&quot;</span>), WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示及更新窗口</span></span><br><span class="line"><span class="built_in">ShowWindow</span>(hWnd, SW_SHOWNORMAL);</span><br><span class="line"><span class="built_in">UpdateWindow</span>(hWnd);</span><br></pre></td></tr></table></figure>

<h4 id="4）消息循环"><a href="#4）消息循环" class="headerlink" title="4）消息循环"></a>4）消息循环</h4><p>在创建窗口、显示窗口、更新窗口后，我们需要编写一个消息循环，不断地从消息队列中取出消息，并进行响应。</p>
<p><strong>a）消息结构体</strong> 在Windows程序中，消息是由MSG结构体来表示的。MSG结构体的定义如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">tagMSG</span> &#123;</span><br><span class="line">    HWND hWnd;   </span><br><span class="line">    UINT message;   </span><br><span class="line">    WPARAM wParam;</span><br><span class="line">    LPARAM lParam;   </span><br><span class="line">    DWORD time;   </span><br><span class="line">    POINT pt;</span><br><span class="line">&#125; MSG;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>hWnd</code>：消息所属的窗口。我们通常开发的程序都是窗口应用程序，一个消息一般都是与某个窗口相关联的。例如，在某个活动窗口中按下鼠标左键，产生的按键消息就是发给该窗口的。</li>
<li><code>message</code>：消息的标识符，是由一个数值来表示的，不同的消息对应不同的数值。Windows将消息对应的数值定义为WM_XXX宏(WM是Windows Message的缩写)的形式， XXX对应某种消息的英文拼写的大写形式。例如，鼠标左键按下消息是WM_LBUTTONDOWN，键盘按下消息是WM_KEYDOWN，字符消息是 WM_CHAR……。</li>
<li><code>wParam</code>： 指定消息的附加信息，如键盘按下会触发WM_KEYDOWN消息，但是，具体按下哪个按键需要wParam区分。</li>
<li><code>lParam</code>：指定消息的附加信息，如鼠标左击会触发WM_LBUTTONDOWN消息，但是，具体点击的坐标需要lParam区分。</li>
<li><code>time</code>：标识一个消息产生时的时间。</li>
<li><code>pt</code>：表示产生这个消息时光标或鼠标的坐标。</li>
</ul>
<p><strong>b）取消息</strong> 要从消息队列中取出消息，我们需要调用GetMessage()函数，该函数的原型声明如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">GetMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    LPMSG lpMsg,</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT wMsgFilterMin,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT wMsgFilterMax)</span></span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>lpMsg</code>：指向一个消息结构体(MSG)，GetMessage从线程的消息队列中取出的消息信息将保存在该结构体变量中。</li>
<li><code>hWnd</code>：指定接收属于哪一个窗口的消息。通常我们将其设置为NULL，用于接收属于调用线程的所有窗口的窗口消息。</li>
<li><code>wMsgFilterMin</code>：指定消息的最小值。</li>
<li><code>wMsgFilterMax</code>：指定消息的最大值。如果wMsgFilterMin和wMsgFilterMax都设置为0， 则接收所有消息。</li>
</ul>
<p>返回值说明：GetMessage函数接收到除 WM_QUIT 外的消息均返回非零值。对于WM_QUIT消息，该函数返回零。如果出现了错误，该函数返回-1，例如，当参数hWnd是无效的窗口句柄或lpMsg是无效的指针时。</p>
<p><strong>c）建立消息循环</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MSG msg;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">GetMessage</span>(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line">    <span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>TranslateMessage</code>：用于翻译、处理和转换消息并把新消息投放到消息队列中，并且此过程不会影响原来的消息队列。</li>
<li><code>DispatechMessage</code>：用于把收到的消息传到窗口回调函数进行分析和处理。即将消息传递给操作系统，让操作系统调用窗口回调函数，来对信息进行处理。</li>
</ul>
<p><strong>d）消息处理机制</strong> <a target="_blank" rel="noopener" href="http://image.camcad.cn/2021/07/2021071913590914.jpg"><img src="http://image.camcad.cn/2021/07/2021071913590914.jpg"></a></p>
<ul>
<li>①　操作系统接收到应用程序的窗口消息，将消息投递到该应用程序的消息队列中。</li>
<li>②　应用程序在消息循环中调用GetMessage函数从消息队列中取出一条一条的消息。取出消息后，应用程序可以对消息进行一些预处理，例如，放弃对某些消息的响应，或者调用TranslateMessage产生新的消息。</li>
<li>③　应用程序调用DispatchMessage，将消息回传给操作系统。消息是由 MSG结构体对象来表示的，其中就包含了接收消息的窗口的句柄。因此， DispatchMessage函数总能进行正确的传递。</li>
<li>④　系统利用WNDCLASS结构体的lpfnWndProc成员保存的窗口过程函数的指针调用窗口过程，对消息进行处理。</li>
</ul>
<h4 id="5）窗口过程函数-消息处理函数"><a href="#5）窗口过程函数-消息处理函数" class="headerlink" title="5）窗口过程函数(消息处理函数)"></a>5）窗口过程函数(消息处理函数)</h4><p>在完成上述步骤后，剩下的工作就是编写一个窗口过程函数，用于处理发送给窗口的消息。</p>
<p>窗口过程函数的名字可以随便取， 如WinProc， 但函数定义的形式必须和下面声明的形式相同：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WinProc</span><span class="params">( <span class="comment">//CALLBACK 和WINAPI 作用一样</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,      <span class="comment">//信息所属的窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uMsg,      <span class="comment">//消息类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加信息(如键盘哪个键按下)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam   <span class="comment">//附加信息(如鼠标点击坐标)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure>

<p>示例代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WinProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hWnd,      <span class="comment">//信息所属的窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uMsg,      <span class="comment">//消息类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,  <span class="comment">//附加信息(如键盘按键)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam   <span class="comment">//附加信息(如鼠标点击坐标)</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_KEYDOWN: <span class="comment">//键盘按下</span></span><br><span class="line">        <span class="comment">//……</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_LBUTTONDOWN: <span class="comment">//鼠标右键按下</span></span><br><span class="line">        <span class="comment">//……</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT: <span class="comment">//绘图事件</span></span><br><span class="line">        <span class="comment">//……</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        <span class="built_in">PostQuitMessage</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_CLOSE: </span><br><span class="line">        <span class="built_in">DestroyWindow</span>(hWnd); </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">//以windows默认方式处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hWnd, uMsg, wParam, lParam);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>DefWindowProc函数</code>：DefWindowProc函数调用默认的窗口过程，对应用程序没有处理的其他消息提供默认处理。</li>
<li><code>WM_CLOSE</code>：对WM_CLOSE消息的响应并不是必须的，如果应用程序没有对该消息进行响应，系统将把这条消息传给DefWindowProc函数而 DefWindowProc函数则调用DestroyWindow函数来响应这条WM_CLOSE消息。</li>
<li><code>WM_DESTROY</code>：DestroyWindow函数在销毁窗口后，会给窗口过程发送 WM_DESTROY消息，我们在该消息的响应代码中调用PostQuitMessage函数。</li>
</ul>
<p>PostQuitMessage函数向应用程序的消息队列中投递一条WM_QUIT消息并返回。WinMain函数中，GetMessage 函数只有在收到WM_QUIT消息时才返回0，此时消息循环才结束，程序退出。传递给 PostQuitMessage函数的参数值将作为WM_QUIT消息的wParam参数，这个值通常用做WinMain函数的返回值。</p>
<h4 id="6）完整示例代码"><a href="#6）完整示例代码" class="headerlink" title="6）完整示例代码"></a>6）完整示例代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6、处理消息（窗口过程）</span></span><br><span class="line"><span class="comment">// CALLBACK  代表 _stdcall 参数的传递顺序,从右到左 以此入栈，并且在函数返回前清空堆栈</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HWND hwnd,          <span class="comment">// 消息所属的窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uMsg,          <span class="comment">// 具体消息名称 WM_XXX 消息名</span></span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,      <span class="comment">// 键盘附加消息</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam       <span class="comment">// 鼠标附加消息</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">        <span class="comment">// 所有xxxWindow为结尾的方法，都不会进入到消息队列中，而是直接执行</span></span><br><span class="line">        <span class="built_in">DestroyWindow</span>(hwnd);            <span class="comment">// DestroyWindow 发送另一个消息 WM_DESTROY</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        <span class="built_in">PostQuitMessage</span>(FALSE);         <span class="comment">// 结束进程</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> WM_LBUTTONDOWN:                <span class="comment">//鼠标左键按下</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> nX_Pos = <span class="built_in">LOWORD</span>(lParam);    <span class="comment">// 窗口X位置</span></span><br><span class="line">        <span class="type">int</span> nY_Pos = <span class="built_in">HIWORD</span>(lParam);    <span class="comment">// 窗口Y位置</span></span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> chBuf[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        <span class="built_in">wsprintf</span>(chBuf, <span class="built_in">TEXT</span>(<span class="string">&quot;X = %d，Y = %d&quot;</span>), nX_Pos, nY_Pos);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">MessageBox</span>(hwnd, chBuf, <span class="built_in">TEXT</span>(<span class="string">&quot;鼠标左键按下&quot;</span>), MB_OK);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> WM_KEYDOWN:                    <span class="comment">//键盘消息</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> nNum = wParam;</span><br><span class="line">        <span class="type">char</span> chBuf[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        <span class="built_in">wsprintf</span>(chBuf, <span class="built_in">TEXT</span>(<span class="string">&quot;键盘按下返回 = %d&quot;</span>), nNum);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">MessageBox</span>(hwnd, chBuf, <span class="built_in">TEXT</span>(<span class="string">&quot;键盘按下&quot;</span>), MB_OK);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:                          <span class="comment">// 绘图</span></span><br><span class="line">    &#123;</span><br><span class="line">        PAINTSTRUCT ps;                     <span class="comment">// 绘图结构体</span></span><br><span class="line">        HDC hdc = <span class="built_in">BeginPaint</span>(hwnd, &amp;ps);    <span class="comment">// 绘画开始</span></span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> chValue[] = <span class="string">&quot;EMMET_绘制文字&quot;</span>;</span><br><span class="line">        <span class="built_in">TextOut</span>(hdc, <span class="number">100</span>, <span class="number">100</span>, <span class="built_in">TEXT</span>(chValue), <span class="built_in">strlen</span>(chValue));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">EndPaint</span>(hwnd, &amp;ps);                <span class="comment">// 绘画结束</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回值用默认处理方式</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd, uMsg, wParam, lParam);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WINAPI 代表 __stdcall 参数的传递顺序,从右到左 以此入栈，并且在函数返回前清空堆栈</span></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,     <span class="comment">// 应用程序实例句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPrevInstance,                <span class="comment">// 上一个应用程序句柄，在win32环境下，参数一般为NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPSTR lpCmdLine,                        <span class="comment">// char * argc[]</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> nShowCmd)</span>                           <span class="comment">// 显示命令、最大化、最小化、正常</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***************************</span></span><br><span class="line"><span class="comment">    *  1、设计窗口              *    </span></span><br><span class="line"><span class="comment">    *  2、注册窗口              *</span></span><br><span class="line"><span class="comment">    *  3、创建窗口              *</span></span><br><span class="line"><span class="comment">    *  4、显示和更新         *</span></span><br><span class="line"><span class="comment">    *  5、通过循环获取消息      *</span></span><br><span class="line"><span class="comment">    *  6、处理消息（窗口过程） *</span></span><br><span class="line"><span class="comment">    ****************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、设计窗口</span></span><br><span class="line">    WNDCLASS wc;</span><br><span class="line">    wc.cbClsExtra = <span class="number">0</span>;                                          <span class="comment">// 类的额外的内存</span></span><br><span class="line">    wc.cbWndExtra = <span class="number">0</span>;                                          <span class="comment">// 窗口额外的内存</span></span><br><span class="line">    wc.hbrBackground = (HBRUSH)<span class="built_in">GetStockObject</span>((WHITE_BRUSH));   <span class="comment">// 设计背景</span></span><br><span class="line">    wc.hCursor = <span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_HAND);                    <span class="comment">// 设置光标，如果第一个参数为NULL，代表使用系统默认光标</span></span><br><span class="line">    wc.hIcon = <span class="built_in">LoadIcon</span>(<span class="literal">NULL</span>, IDI_ERROR);                       <span class="comment">// 图标，如果第一个参数为NULL，代表使用系统默认图标</span></span><br><span class="line">    wc.hInstance = hInstance;                                   <span class="comment">// 应用程序实例句柄，传入WinMain中的形参即可</span></span><br><span class="line">    wc.lpfnWndProc = WindowProc;                                <span class="comment">// 回调函数，窗口过程</span></span><br><span class="line">    wc.lpszClassName = <span class="built_in">TEXT</span>(<span class="string">&quot;EMMET_WIN&quot;</span>);                     <span class="comment">// 指定窗口类名称</span></span><br><span class="line">    wc.lpszMenuName = <span class="literal">NULL</span>;                                     <span class="comment">// 菜单名称</span></span><br><span class="line">    wc.style = <span class="number">0</span>;                                               <span class="comment">// 显示风格，0代表默认风格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、注册窗口</span></span><br><span class="line">    <span class="built_in">RegisterClass</span>(&amp;wc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、创建窗口</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    lpClassName,        // 类名</span></span><br><span class="line"><span class="comment">    lpWindowName,       // 标题名</span></span><br><span class="line"><span class="comment">    dwStyle,            // WS_OVERLAPPEDWINDOW  风格</span></span><br><span class="line"><span class="comment">    x,                  // CW_USEDEFAULT        默认值</span></span><br><span class="line"><span class="comment">    y,                  // CW_USEDEFAULT        默认值</span></span><br><span class="line"><span class="comment">    nWidth,             // CW_USEDEFAULT        默认值</span></span><br><span class="line"><span class="comment">    nHeight,            // CW_USEDEFAULT        默认值</span></span><br><span class="line"><span class="comment">    hWndParent,         // 父窗口 NULL</span></span><br><span class="line"><span class="comment">    hMenu,              // 菜单 NULL</span></span><br><span class="line"><span class="comment">    hInstance,          // 实例句柄 hInstance</span></span><br><span class="line"><span class="comment">    lpParam             // NULL 附加值 鼠标附加值   </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    HWND hwnd = <span class="built_in">CreateWindow</span>(wc.lpszClassName, <span class="built_in">TEXT</span>(<span class="string">&quot;EMMET_WINDOW_TEST&quot;</span>), WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4、显示和更新</span></span><br><span class="line">    <span class="built_in">ShowWindow</span>(hwnd, SW_SHOWNORMAL);</span><br><span class="line">    <span class="built_in">UpdateWindow</span>(hwnd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5、通过循环获取消息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    HWND        hwnd;       // 主窗口句柄</span></span><br><span class="line"><span class="comment">    UINT        message;    // 具体消息名称</span></span><br><span class="line"><span class="comment">    WPARAM      wParam;     // 附加消息 键盘消息</span></span><br><span class="line"><span class="comment">    LPARAM      lParam;     // 附加消息 鼠标消息</span></span><br><span class="line"><span class="comment">    DWORD       time;       // 消息产生时间</span></span><br><span class="line"><span class="comment">    POINT       pt;         // 附加消息 鼠标消息（位置 --&gt; X、Y）</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    MSG msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (TRUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        _Out_ LPMSG lpMsg,          // 消息</span></span><br><span class="line"><span class="comment">        _In_opt_ HWND hWnd,         // 捕获窗口 填写NULL代表捕获所有的窗口</span></span><br><span class="line"><span class="comment">        _In_ UINT wMsgFilterMin,    // 最小和最大的过滤的消息 一般填入0</span></span><br><span class="line"><span class="comment">        _In_ UINT wMsgFilterMax);   // 填0代表获取所有消息</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">GetMessage</span>(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>) == FALSE) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 翻译消息</span></span><br><span class="line">        <span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分发消息</span></span><br><span class="line">        <span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>蚂蚁Emmet
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://notes.camcad.cn/post/c5f28f8.html" title="MFC新手村01：Windows消息机制">https://notes.camcad.cn/post/c5f28f8.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/C-C/" rel="tag"># C/C++</a>
              <a href="/tags/MFC/" rel="tag"># MFC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/a55f1847.html" rel="prev" title="QT新手村05：信号和槽机制">
                  <i class="fa fa-chevron-left"></i> QT新手村05：信号和槽机制
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/ba6e8975.html" rel="next" title="MFC新手村02：MFC入门">
                  MFC新手村02：MFC入门 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备20003716号-1 </a>
      <img src="http://image.camcad.cn/2024/02/gongan_icon.png" alt=""><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43122302000045" rel="noopener" target="_blank">湘公网安备43122302000045号 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">蚂蚁Emmet</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
